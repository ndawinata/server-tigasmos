<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tigasmos</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"> </script>
</head>

<body>
    <div class="container mt-3">
        <h1>Tigasmos Coba</h1>
        <div class="dropdown-divider my-3"></div>
        <h3>Kirim Data ke Site 1</h3>
        <form>
            <div class="form-group">
                <label for="">sensor tekanan :</label>
                <input type="text" class="form-control" placeholder="masukkan nilai" id="pasutt">
            </div>
            <div class="form-group">
                <label for="">sensor ultrasonik :</label>
                <input type="text" class="form-control" placeholder="masukkan nilai" id="pasutu">
                </label>
                <input type="button" class="btn btn-primary my-4" id="kirim" value="Kirim">
                <!-- <button type="submit" class="btn btn-primary mb-2">Confirm identity</button>
            <input type="button" class="btn btn-primary" id="kirim" value="Kirim"> -->
        </form>
        <div class="dropdown-divider my-3"></div>
        <div class='container' id='eqmap'>
            <!-- gambar EQMAP -->
            <h2>Map Gempa Terkini</h2>
            <img src="https://data.bmkg.go.id/eqmap.gif" alt="eqmap" height="250" width="250">
        </div>
        <div class="dropdown-divider my-5"></div>
        <div class="container mt-3">
            <h3>Pasut Site 1</h3>
            <table class="table table-bordered mt-3">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>Date</th>
                        <th>Pasut Sensor (tekanan)</th>
                        <th>Pasut Sensor (ultrasonik)</th>
                    </tr>
                </thead>
                <tbody id="lists"></tbody>
            </table>
        </div>
        <div class="dropdown-divider my-5"></div>
        <div class="container mt-3">
            <h3>Gempa Terkini</h3>
            <table class="table table-bordered mt-3">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>Tanggal</th>
                        <th>Jam</th>
                        <th>Lintang</th>
                        <th>Bujur</th>
                        <th>Mangnitude</th>
                        <th>Kedalaman</th>
                        <th>Wilayah</th>
                    </tr>
                </thead>
                <tbody id="gempaupdate"></tbody>
            </table>
        </div>
        <div class="dropdown-divider my-5"></div>
        <div class="container mt-3">
            <h3>Info Potensi Tsunami</h3>
            <table class="table table-bordered mt-3">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>Tanggal</th>
                        <th>Jam</th>
                        <th>Lintang</th>
                        <th>Bujur</th>
                        <th>Mangnitude</th>
                        <th>Kedalaman</th>
                        <th>Area</th>
                    </tr>
                </thead>
                <tbody id="tsunami"></tbody>
            </table>
        </div>
        <div class="dropdown-divider my-5"></div>
        <div class="container mt-3">
            <h3>60 Gempa Terkini</h3>
            <table class="table table-bordered mt-3">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>Tanggal</th>
                        <th>Jam</th>
                        <th>Lintang</th>
                        <th>Bujur</th>
                        <th>Mangnitude</th>
                        <th>Kedalaman</th>
                        <th>Wilayah</th>
                    </tr>
                </thead>
                <tbody id="gempa"></tbody>
            </table>
        </div>


        <script src="http://code.jquery.com/jquery-latest.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/x2js/1.2.0/xml2json.js"></script>
        <script>
            $(function () {
                var socket = io.connect('http://localhost:5000')

                var name = $("#name")
                var pasutT = $("#pasutt")
                var pasutU = $("#pasutu")
                var name = $("#name")
                var kirim = $("#kirim")
                var lists = $("#lists")
                var gempaup = $('#gempaupdate')
                var gempa = $('#gempa')
                var tsunami = $('#tsunami')
                var no = 1
                var nomerh = 1
                kirim.click(function () {
                    // console.log(pasutT.val() + pasutU.val())
                    var date = new Date()
                    let dataPasut = {
                        "date": date,
                        "pasut_sensor_tekanan": pasutT.val(),
                        "pasut_sensor_ultrasonik": pasutU.val()
                    }
                    console.log(dataPasut)
                    // var coba = JSON.stringify(dataPasut)
                    // var obj = JSON.parse(JSON.stringify(dataPasut))
                    // console.log(JSON.parse(JSON.stringify(dataPasut)))
                    axios.post("http://tigasmos-stmkg.my.id:5000/api/site-1", dataPasut)
                        .then(response => console.log(response))
                })

                pasutT.val('')
                pasutU.val('')

                // Get Json dan masukkan ke tabel

                axios.get('http://tigasmos-stmkg.my.id:5000/api/site-1')
                    // .then(response => response.data.datas.forEach(element => console.log(element.name)))
                    // .then(response => console.log(response.data.datas))
                    // .then(response => response.data.datas.forEach(element => console.log(element.name)))
                    // .then(element => console.log(element.data.datas))
                    .then(response => {
                        this.data = response.data.datas
                        this.data.forEach(function (item) {
                            lists.append(
                                "<tr><td>" + nomerh++ +
                                "</td><td>" + item.date +
                                "</td><td>" + item.pasut_sensor_tekanan +
                                "</td><td>" + item.pasut_sensor_ultrasonik +
                                "</td></tr>"
                            )
                        })
                    })
                socket.on('site1', (data) => {
                    console.log(data)
                    lists.append(
                        "<tr><td>" + nomerh++ +
                        "</td><td>" + data.date +
                        "</td><td>" + data.pasut_sensor_tekanan +
                        "</td><td>" + data.pasut_sensor_ultrasonik +
                        "</td></tr>")
                })



                // get data xml and convert to JSON

                // data Auto Gempa *------Data Tunggal cuy-------*
                $.ajax({
                    type: "GET",
                    url: "https://data.bmkg.go.id/autogempa.xml",
                    dataType: "xml",
                    success: function (xmlDoc) {
                        var x2js = new X2JS();
                        var gempaupJson = x2js.xml2json(xmlDoc)
                        // console.log(gempaupJson)
                        var data = gempaupJson.Infogempa.gempa
                        var nomer = 1
                        gempaup.append(
                            "<tr><td>" + nomer++ +
                            "</td><td>" + data.Tanggal +
                            "</td><td>" + data.Jam +
                            "</td><td>" + data.Lintang +
                            "</td><td>" + data.Bujur +
                            "</td><td>" + data.Magnitude +
                            "</td><td>" + data.Kedalaman +
                            "</td><td>" + "wil 1 : " + data.Wilayah1 +
                            "<br>" + "wil 2 : " + data.Wilayah2 +
                            "<br>" + "wil 3 : " + data.Wilayah3 +
                            "<br>" + "wil 4 : " + data.Wilayah4 +
                            "<br>" + "wil 5 : " + data.Wilayah5 +
                            "</td></tr>"
                        )
                    }
                });


                // data Potensi Tsunami *------Data Tunggal cuy-------*
                $.ajax({
                    type: "GET",
                    url: "https://data.bmkg.go.id/lasttsunami.xml",
                    dataType: "xml",
                    success: function (xmlDoc) {
                        var x2js = new X2JS();
                        var tsunamiJson = x2js.xml2json(xmlDoc)
                        // console.log(tsunamiJson.Infotsunami.length)
                        var data = tsunamiJson.Infotsunami.Gempa
                        var nomer = 1
                        tsunami.append(
                            "<tr><td>" + nomer++ +
                            "</td><td>" + data.Tanggal +
                            "</td><td>" + data.Jam +
                            "</td><td>" + data.Lintang +
                            "</td><td>" + data.Bujur +
                            "</td><td>" + data.Magnitude +
                            "</td><td>" + data.Kedalaman +
                            "</td><td>" + data.Area +
                            "</td></tr>")
                    }
                });

                //  Data Gempa terkini *------Data Jamak cuy-------*
                $.ajax({
                    type: "GET",
                    url: "https://data.bmkg.go.id/gempaterkini.xml",
                    dataType: "xml",
                    success: function (xmlDoc) {
                        var x2js = new X2JS();
                        var gempaJson = x2js.xml2json(xmlDoc)
                        // console.log(gempaJson.Infogempa.gempa)
                        var data = gempaJson.Infogempa.gempa
                        var nomerG = 1
                        data.forEach(data =>
                            gempa.append(
                                "<tr><td>" + nomerG++ +
                                "</td><td>" + data.Tanggal +
                                "</td><td>" + data.Jam +
                                "</td><td>" + data.Lintang +
                                "</td><td>" + data.Bujur +
                                "</td><td>" + data.Magnitude +
                                "</td><td>" + data.Kedalaman +
                                "</td><td>" + data.Wilayah +
                                "</td></tr>")
                        )
                    }
                });
            })
        </script>
</body>

</html>